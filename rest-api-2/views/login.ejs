<%- include('partials/header'); -%>

<h2></h2>
<h2>Prisijungimas</h2>
<form id="loginForm">
  <label>Email:</label>
  <input id="email" type="text" placeholder="email" required />

  <label>Slaptažodis:</label>
  <input id="password" type="password" placeholder="slaptažodis" required />

  <input type="submit" value="Prisijungti" />
</form>
<p id="message"></p>

<script>
  document.getElementById("loginForm").onsubmit = function (event) {
    event.preventDefault();
    const messageElement = document.getElementById("message");
    const body = { email: email.value, password: password.value };
    messageElement.textContent = "...";

    fetch("/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    })
      .then(function (response) {
        return response.json();
      })
      .then(function (data) {
        if (data && data.token) {
          localStorage.setItem("token", data.token);
          location.href = "/todos";
        } else {
          messageElement.textContent =
            data && data.error ? data.error : "Klaida";
        }
      })
      .catch(function (error) {
        messageElement.textContent = String(
          error && error.message ? error.message : error
        );
      });
  };
</script>

<%- include('partials/footer'); -%>
